<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        />

        <title>Sign Up Music Playlist Explorer</title>
        <link
            rel="icon"
            type="image/x-icon"
            href="/images/favicon.ico"
        />

        <link
            rel="stylesheet"
            href="style.css"
        />
    </head>

    <body>
        <header>
            <!-- Your header content here -->
            <h1>Music PlayList Explorer</h1>
        </header>

        <main>
            <h2>Sign Up with email and password</h2>
            <form
                action=""
                id="signupForm"
            >
                <label for="email">Enter your email:</label>
                <input
                    type="email"
                    id="email"
                    name="email"
                />

                <label for="pass">Password (6 characters minimum):</label>
                <input
                    type="password"
                    id="pass"
                    name="password"
                    minlength="6"
                    required
                />

                <input
                    type="submit"
                    value="Sign Up"
                />
            </form>
        </main>

        <footer>
            <!-- Your footer content here -->
        </footer>
        <!-- <script src="data/data.js"></script> -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> -->

        <!-- <script type="module" src="script.js"></script> -->
        <script type="module">
            // In a project with react or webpack (etc) this would be replaced with the supabase npm package
            import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

            // Generates a supabase client connection
            const supabase = createClient(
                "https://zkjmdhhvcxwjgjsryyow.supabase.co",
                "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpram1kaGh2Y3h3amdqc3J5eW93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTc2MjAxMjQsImV4cCI6MjAzMzE5NjEyNH0.M3aEkryg17fMtWrC1hKigqovebKhSOz5P4Y1Pd17ug4"
            );
            console.log(supabase);
            /**
             * binds a listner to the the auth state change
             * redirects if the user is loged in
             */
            const { stateChange } = supabase.auth.onAuthStateChange((event, session) => {
                console.log(event, session);

                if (event === "INITIAL_SESSION") {
                    // handle initial session
                } else if (event === "SIGNED_IN") {
                    window.location.href = "/";
                } else if (event === "SIGNED_OUT") {
                } else if (event === "PASSWORD_RECOVERY") {
                    // handle password recovery event
                } else if (event === "TOKEN_REFRESHED") {
                    // handle token refreshed event
                } else if (event === "USER_UPDATED") {
                    // handle user updated event
                }
            });

            // from https://www.freecodecamp.org/news/how-to-submit-a-form-with-javascript/
            let signupForm = document.getElementById("signupForm");
            signupForm.addEventListener("submit", async (e) => {
                e.preventDefault();

                // handle submit
                let email = document.getElementById("email");
                let password = document.getElementById("pass");

                if (email.value == "" || password.value.length < 6) {
                    alert("Ensure you input a value in both fields!");
                } else {
                    // perform operation with form input
                    const { data, error } = await supabase.auth.signUp({
                        email: email.value,
                        password: password.value,
                    })
                    if(error){
                        alert(error);

                    }
                }
            });
        </script>
    </body>
</html>
